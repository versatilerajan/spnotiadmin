<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SP Notification ‚Äì Admin Panel</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #0d9488 0%, #14b8a6 50%, #5eead4 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    
    .card {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      padding: 40px;
      width: 100%;
      max-width: 480px;
      max-height: 90vh;
      overflow-y: auto;
      border-radius: 20px;
      border: 2px solid #a855f7;
      box-shadow: 0 8px 32px rgba(168, 85, 247, 0.2),
                  0 0 20px rgba(168, 85, 247, 0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 40px rgba(168, 85, 247, 0.3),
                  0 0 30px rgba(168, 85, 247, 0.2);
    }

    .card::-webkit-scrollbar {
      width: 8px;
    }

    .card::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
    }

    .card::-webkit-scrollbar-thumb {
      background: rgba(168, 85, 247, 0.5);
      border-radius: 10px;
    }

    .card::-webkit-scrollbar-thumb:hover {
      background: rgba(168, 85, 247, 0.7);
    }
    
    h2, h3 {
      text-align: center;
      color: #fff;
      font-weight: 600;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
    }

    h2 {
      margin-bottom: 30px;
      font-size: 28px;
    }

    h3 {
      margin: 25px 0 15px;
      font-size: 22px;
    }
    
    input, textarea {
      width: 100%;
      margin-top: 15px;
      padding: 14px 18px;
      font-size: 15px;
      background: rgba(255, 255, 255, 0.9);
      border: 2px solid transparent;
      border-radius: 12px;
      outline: none;
      transition: all 0.3s ease;
      color: #1f2937;
    }
    
    input:focus, textarea:focus {
      background: rgba(255, 255, 255, 1);
      border-color: #a855f7;
      box-shadow: 0 0 0 4px rgba(168, 85, 247, 0.1);
    }
    
    input::placeholder, textarea::placeholder {
      color: #6b7280;
    }
    
    textarea {
      resize: vertical;
      min-height: 100px;
      font-family: inherit;
    }
    
    button {
      width: 100%;
      margin-top: 20px;
      padding: 14px;
      font-size: 16px;
      font-weight: 600;
      background: linear-gradient(135deg, #9333ea, #a855f7);
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 12px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(168, 85, 247, 0.3);
    }
    
    button:hover {
      background: linear-gradient(135deg, #7e22ce, #9333ea);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(168, 85, 247, 0.4);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    .hidden {
      display: none;
    }
    
    .message {
      text-align: center;
      margin-top: 15px;
      padding: 12px;
      border-radius: 8px;
      font-weight: 500;
      animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .error {
      background: rgba(239, 68, 68, 0.2);
      color: #fee;
      border: 1px solid rgba(239, 68, 68, 0.5);
    }
    
    .success {
      background: rgba(34, 197, 94, 0.2);
      color: #f0fdf4;
      border: 1px solid rgba(34, 197, 94, 0.5);
    }

    hr {
      border: none;
      height: 2px;
      background: linear-gradient(90deg, 
        transparent, 
        rgba(168, 85, 247, 0.5), 
        transparent);
      margin: 30px 0;
    }

    .post-item {
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(5px);
      border: 2px solid rgba(168, 85, 247, 0.4);
      padding: 15px;
      margin-top: 12px;
      border-radius: 12px;
      transition: all 0.3s ease;
    }

    .post-item:hover {
      background: rgba(255, 255, 255, 0.25);
      border-color: rgba(168, 85, 247, 0.6);
      transform: translateX(5px);
    }

    .post-item strong {
      color: #fff;
      font-size: 16px;
      display: block;
      margin-bottom: 8px;
    }

    .post-item small {
      color: rgba(255, 255, 255, 0.8);
      font-size: 13px;
      display: block;
      margin-bottom: 10px;
    }

    .delete-btn {
      margin-top: 10px;
      background: linear-gradient(135deg, #dc2626, #ef4444);
      font-size: 14px;
      padding: 10px;
    }

    .delete-btn:hover {
      background: linear-gradient(135deg, #b91c1c, #dc2626);
    }

    #postsList:empty::after {
      content: "No posts yet";
      display: block;
      text-align: center;
      color: rgba(255, 255, 255, 0.7);
      padding: 20px;
      font-style: italic;
    }
  </style>
</head>
<body>

  <!-- LOGIN PANEL -->
  <div class="card" id="loginBox">
    <h2>üîê Admin Login</h2>
    <input type="text" id="adminId" placeholder="Admin ID" />
    <input type="password" id="adminPass" placeholder="Admin Password" />
    <button onclick="login()">Login</button>
    <div class="message error hidden" id="loginError"></div>
  </div>

  <!-- ADMIN PANEL -->
  <div class="card hidden" id="postBox">
    <h2>üì¢ Post Notification</h2>

    <input type="text" id="title" placeholder="Title" />
    <textarea id="description" placeholder="Description"></textarea>
    <input type="text" id="photo" placeholder="Google Drive Image Link" />

    <button onclick="postNotification()">Post Notification</button>
    <div class="message success hidden" id="postSuccess"></div>
    <div class="message error hidden" id="postError"></div>

    <hr>

    <h3>üìã All Posts</h3>
    <div id="postsList"></div>
  </div>

<script>
  const API_BASE = "https://spnotificationdbmongodb.vercel.app";

  /* ---------------- LOGIN ---------------- */
  function login() {
    const adminId = document.getElementById("adminId").value.trim();
    const adminPass = document.getElementById("adminPass").value.trim();

    if (!adminId || !adminPass) {
      showMessage("loginError", "Please fill in all fields");
      return;
    }

    fetch(`${API_BASE}/admin/login`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ adminId, adminPass })
    })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        onLoginSuccess();
      } else {
        showMessage("loginError", "Invalid admin credentials");
      }
    })
    .catch(() => {
      showMessage("loginError", "Server error. Please try again.");
    });
  }

  function onLoginSuccess() {
    document.getElementById("loginBox").classList.add("hidden");
    document.getElementById("postBox").classList.remove("hidden");
    loadPosts();
  }

  /* ---------------- POSTS ---------------- */
  function postNotification() {
    const title = document.getElementById("title").value.trim();
    const description = document.getElementById("description").value.trim();
    const photo = document.getElementById("photo").value.trim();

    if (!title || !description || !photo) {
      showMessage("postError", "All fields are required");
      return;
    }

    fetch(`${API_BASE}/posts`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ title, description, photo })
    })
    .then(res => res.json())
    .then(data => {
      if (data._id) {
        showMessage("postSuccess", "Post created successfully!");
        hideMessage("postError");
        document.getElementById("title").value = "";
        document.getElementById("description").value = "";
        document.getElementById("photo").value = "";
        loadPosts();
        
        // Auto-hide success message after 3 seconds
        setTimeout(() => hideMessage("postSuccess"), 3000);
      } else {
        showMessage("postError", "Failed to create post");
        hideMessage("postSuccess");
      }
    })
    .catch(() => {
      showMessage("postError", "Server error. Please try again.");
      hideMessage("postSuccess");
    });
  }

  function loadPosts() {
    fetch(`${API_BASE}/posts`)
      .then(res => res.json())
      .then(posts => {
        const list = document.getElementById("postsList");
        list.innerHTML = "";

        posts.forEach(post => {
          const div = document.createElement("div");
          div.className = "post-item";

          div.innerHTML = `
            <strong>${escapeHtml(post.title)}</strong>
            <small>${new Date(post.date).toLocaleString()}</small>
            <button class="delete-btn" onclick="deletePost('${post._id}')">
              üóëÔ∏è Delete
            </button>
          `;

          list.appendChild(div);
        });
      })
      .catch(() => {
        const list = document.getElementById("postsList");
        list.innerHTML = '<div class="message error">Failed to load posts</div>';
      });
  }

  function deletePost(id) {
    if (!confirm("Are you sure you want to delete this post?")) return;

    fetch(`${API_BASE}/posts/${id}`, {
      method: "DELETE"
    })
    .then(() => loadPosts())
    .catch(() => {
      alert("Failed to delete post");
    });
  }

  /* ---------------- UTILITIES ---------------- */
  function showMessage(elementId, message) {
    const el = document.getElementById(elementId);
    el.innerText = message;
    el.classList.remove("hidden");
  }

  function hideMessage(elementId) {
    const el = document.getElementById(elementId);
    el.classList.add("hidden");
  }

  function escapeHtml(text) {
    const map = {
      '&': '&amp;',
      '<': '&lt;',
      '>': '&gt;',
      '"': '&quot;',
      "'": '&#039;'
    };
    return text.replace(/[&<>"']/g, m => map[m]);
  }

  // Enter key support for login
  document.addEventListener("keypress", (e) => {
    if (e.key === "Enter" && !document.getElementById("loginBox").classList.contains("hidden")) {
      login();
    }
  });
</script>

</body>
</html>
